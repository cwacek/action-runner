{"id":"ar-4hv","title":"clarify README on default labels and images","description":"the README talks about how to set configurations, but it's not clear if there are any default configs, and if they don't exist how to create them. If there are default configs, what image do they use? If there aren't doesn't that maek the image builder not optional. Don't modify  code for this, just clarify README and if it needs adjusting we'll make new openspec feature","status":"closed","priority":2,"issue_type":"task","owner":"cwacek@gmail.com","created_at":"2026-01-27T12:27:31.523432-05:00","created_by":"Chris Wacek","updated_at":"2026-01-27T12:28:59.370583-05:00","closed_at":"2026-01-27T12:28:59.370583-05:00","close_reason":"Updated README.md to clarify:\n- Default config IS created at /spot-runner/configs/default but uses placeholder AMI\n- Added new Step 4 'Create a runner AMI' explaining both options (Image Builder or BYOA)\n- Clarified that AMI must be updated before runners will work\n- Added note in SSM Parameters section about default config placeholder\n- Updated Custom AMI Creation section with clearer requirements table"}
{"id":"ar-8ja","title":"Ensure shasum checks on all network fetches","description":"Any time something is fetched from the netowrk at runtime, it needs to be sha256 authenticated. If we can't do that, we should always bake it in","status":"closed","priority":2,"issue_type":"task","owner":"cwacek@gmail.com","created_at":"2026-01-26T23:29:28.096039-05:00","created_by":"Chris Wacek","updated_at":"2026-01-27T09:20:04.158707-05:00","closed_at":"2026-01-27T09:20:04.158707-05:00","close_reason":"Hardcoded SHA256 checksums for GitHub Actions runner v2.331.0 in both ami/bootstrap.sh and lambda/lib/provisioner.ts. Checksums are now embedded in code (x64: 5fcc01bd..., arm64: f5863a21...) rather than fetched at runtime, protecting against supply chain attacks where both tarball and checksum file could be compromised.","comments":[{"id":1,"issue_id":"ar-8ja","author":"Chris Wacek","text":"Downloading shasums at download time isn't good enough because it doesn't protect against supply chain attacks. We need to hard code the shasums in our code _now_ to verify that","created_at":"2026-01-27T14:15:41Z"}]}
{"id":"ar-8se","title":"subnetId not valid on deploy","description":"cdk deploy failed with the following error 'ImagePipeline-linux-x64/InfraConfig\\n Resource handler returned message: The value supplied for parameter 'subnetId' is not valid. If a 'subnetId' is specified, 'securityGroupIds' must also be provided.","status":"closed","priority":2,"issue_type":"bug","owner":"cwacek@gmail.com","created_at":"2026-01-27T19:55:45.194925-05:00","created_by":"Chris Wacek","updated_at":"2026-01-27T20:06:20.775722-05:00","closed_at":"2026-01-27T20:06:20.775722-05:00","close_reason":"Added BuildSecurityGroup and securityGroupIds to InfraConfig in runner-image-pipeline.ts"}
{"id":"ar-9ip","title":"Status Page \u0026 AMI Lifecycle","description":"## Overview\nImplement the status-page OpenSpec change to provide system readiness visibility and automated AMI lifecycle management.\n\n## Capabilities\n- **status-api**: HTTP endpoint returning system health and configuration readiness\n- **ami-lifecycle**: Automated AMI management with EventBridge triggers\n- **infrastructure-deployment** (modified): CDK-defined presets replace manual SSM setup\n\n## Specs\n- openspec/changes/status-page/proposal.md\n- openspec/changes/status-page/design.md\n- openspec/changes/status-page/specs/\n\n## Acceptance Criteria\n- /status endpoint returns preset readiness (ready/building/degraded)\n- Image Builder completion auto-updates DynamoDB and SSM\n- Presets defined in CDK, no manual AMI configuration needed","status":"closed","priority":1,"issue_type":"epic","owner":"cwacek@gmail.com","created_at":"2026-01-27T15:00:30.716207-05:00","created_by":"Chris Wacek","updated_at":"2026-01-27T15:37:57.532592-05:00","closed_at":"2026-01-27T15:37:57.532592-05:00","close_reason":"Implemented status-page change: presets replace manual config, /status endpoint, AMI lifecycle automation via EventBridge, Image Builder integration"}
{"id":"ar-9ip.1","title":"CDK Infrastructure Updates for Status Page","description":"## Requirements\n- Add presets configuration to CDK stack props to define runner presets\n- Implement preset validation to ensure configuration is valid\n- Create DynamoDB schema for AMI state tracking (PK: AMI#preset-name, SK: LATEST)\n- Set up EventBridge rule to capture Image Builder completion events\n- Configure IAM roles for both the AMI Update Lambda and Status API Lambda\n\n## Acceptance Criteria\n- Stack props accept a presets configuration object\n- Invalid preset configs are rejected at synth time with clear error messages\n- DynamoDB table created with correct key schema for AMI state\n- EventBridge rule filters for Image Builder state change events\n- IAM roles follow least-privilege principle for DynamoDB and SSM access\n\n## Context\n- This is the foundational infrastructure task that blocks all other status-page tasks\n- Related spec: openspec/changes/status-page/\n- DynamoDB table will store AMI state per preset (ready, building, degraded)\n- EventBridge rule pattern should match: source=aws.imagebuilder, detail-type=EC2 Image Builder Image State Change","status":"closed","priority":2,"issue_type":"task","owner":"cwacek@gmail.com","created_at":"2026-01-27T15:02:01.501722-05:00","created_by":"Chris Wacek","updated_at":"2026-01-27T15:25:42.416568-05:00","closed_at":"2026-01-27T15:25:42.416568-05:00","close_reason":"Implemented: presets interface, validation, DynamoDB GSI for AMI state, EventBridge rule, IAM roles for both Lambdas","labels":["infrastructure"],"dependencies":[{"issue_id":"ar-9ip.1","depends_on_id":"ar-9ip","type":"parent-child","created_at":"2026-01-27T15:02:01.503649-05:00","created_by":"Chris Wacek"}]}
{"id":"ar-9ip.2","title":"AMI Update Lambda Implementation","description":"## Requirements\n- Create lambda/ami-update/index.ts handler\n- Extract AMI ID and build status from Image Builder events\n- Implement DynamoDB conditional update (only write if timestamp is newer)\n- Update SSM parameter with merged configuration including new AMI ID\n- Handle failed builds gracefully (update status without changing AMI ID)\n- Integrate Lambda into CDK stack with EventBridge trigger\n\n## Acceptance Criteria\n- Lambda correctly parses Image Builder event payload\n- Conditional writes prevent race conditions (older events don't overwrite newer)\n- SSM parameter contains valid JSON with AMI ID and preset config\n- Failed builds update DynamoDB status to 'degraded' without losing current AMI\n- Lambda has appropriate timeout and memory settings\n- EventBridge trigger correctly routes Image Builder events to Lambda\n\n## Context\n- Blocked by: CDK Infrastructure Updates\n- Lambda receives events from EventBridge when Image Builder completes\n- Must handle both successful and failed image builds\n- SSM parameter path format: /github-runners/{preset-name}/config","status":"closed","priority":2,"issue_type":"task","owner":"cwacek@gmail.com","created_at":"2026-01-27T15:02:01.844848-05:00","created_by":"Chris Wacek","updated_at":"2026-01-27T15:28:44.242873-05:00","closed_at":"2026-01-27T15:28:44.242873-05:00","close_reason":"Implemented AMI Update Lambda handler with: EventBridge event processing, AMI ID extraction, DynamoDB conditional updates, SSM parameter updates","labels":["lambda"],"dependencies":[{"issue_id":"ar-9ip.2","depends_on_id":"ar-9ip","type":"parent-child","created_at":"2026-01-27T15:02:01.847014-05:00","created_by":"Chris Wacek"},{"issue_id":"ar-9ip.2","depends_on_id":"ar-9ip.1","type":"blocks","created_at":"2026-01-27T15:02:24.050345-05:00","created_by":"Chris Wacek"}]}
{"id":"ar-9ip.3","title":"Status API Lambda Implementation","description":"## Requirements\n- Create lambda/status/index.ts handler\n- Query all AMI state records from DynamoDB\n- Implement status aggregation logic (ready/building/degraded)\n- Generate human-readable status messages\n- Add Lambda to CDK with API Gateway /status GET route (unauthenticated)\n\n## Acceptance Criteria\n- Lambda returns JSON with overall status and per-preset details\n- Status values: 'ready' (all presets healthy), 'building' (update in progress), 'degraded' (failures present)\n- Human-readable messages explain current state (e.g., \"AMI update in progress for linux-x64\")\n- /status endpoint is publicly accessible without authentication\n- Response includes timestamp and version information\n\n## Context\n- Blocked by: CDK Infrastructure Updates\n- This endpoint is used for monitoring and observability\n- Response format should be suitable for status page integration\n- Consider adding cache headers to reduce DynamoDB reads","status":"closed","priority":2,"issue_type":"task","owner":"cwacek@gmail.com","created_at":"2026-01-27T15:02:02.213825-05:00","created_by":"Chris Wacek","updated_at":"2026-01-27T15:28:44.873813-05:00","closed_at":"2026-01-27T15:28:44.873813-05:00","close_reason":"Implemented Status API Lambda handler with: /status GET endpoint, AMI state querying, status aggregation (ready/building/degraded), human-readable messages","labels":["lambda"],"dependencies":[{"issue_id":"ar-9ip.3","depends_on_id":"ar-9ip","type":"parent-child","created_at":"2026-01-27T15:02:02.215865-05:00","created_by":"Chris Wacek"},{"issue_id":"ar-9ip.3","depends_on_id":"ar-9ip.1","type":"blocks","created_at":"2026-01-27T15:02:24.373169-05:00","created_by":"Chris Wacek"}]}
{"id":"ar-9ip.4","title":"Preset Configuration Management","description":"## Requirements\n- Update RunnerImagePipeline construct to accept preset configuration\n- Store preset configuration in DynamoDB on deployment\n- Create initial AMI state record on first deploy (status: 'building')\n- Configure Image Builder pipeline schedule from preset config\n- Implement custom resource to trigger immediate pipeline execution on deploy\n\n## Acceptance Criteria\n- RunnerImagePipeline construct accepts preset name, instance type, schedule, and other config\n- DynamoDB populated with preset config during CDK deploy\n- Initial state record created with status 'building' and null AMI ID\n- Pipeline schedule configurable (e.g., daily, weekly, or cron expression)\n- Custom resource triggers pipeline after initial deployment for immediate AMI creation\n\n## Context\n- Blocked by: CDK Infrastructure Updates\n- Presets define different runner configurations (e.g., linux-x64-small, linux-x64-large)\n- Each preset gets its own Image Builder pipeline and AMI\n- Custom resource uses AWS SDK to start pipeline execution","status":"closed","priority":2,"issue_type":"task","owner":"cwacek@gmail.com","created_at":"2026-01-27T15:02:02.552742-05:00","created_by":"Chris Wacek","updated_at":"2026-01-27T15:31:23.628248-05:00","closed_at":"2026-01-27T15:31:23.628248-05:00","close_reason":"Implemented: RunnerImagePipeline with preset/architecture support, PresetInitializer custom resource for DynamoDB init and pipeline trigger, weekly pipeline schedule","labels":["infrastructure"],"dependencies":[{"issue_id":"ar-9ip.4","depends_on_id":"ar-9ip","type":"parent-child","created_at":"2026-01-27T15:02:02.553963-05:00","created_by":"Chris Wacek"},{"issue_id":"ar-9ip.4","depends_on_id":"ar-9ip.1","type":"blocks","created_at":"2026-01-27T15:02:24.688118-05:00","created_by":"Chris Wacek"}]}
{"id":"ar-9ip.5","title":"SSM Parameter Integration","description":"## Requirements\n- Generate SSM parameter path from preset name (e.g., /github-runners/{preset}/config)\n- Create SSM parameter on deploy with placeholder AMI ID\n- Update webhook handler to read AMI ID from SSM parameter\n- Ensure SSM parameter contains all config needed for runner provisioning\n\n## Acceptance Criteria\n- SSM path follows consistent naming convention\n- Initial SSM parameter created with placeholder value on first deploy\n- Webhook handler reads AMI ID from SSM instead of hardcoded value\n- SSM parameter contains: AMI ID, instance type, and other runner config\n- SSM reads are cached appropriately in webhook handler\n\n## Context\n- Blocked by: CDK Infrastructure Updates, Preset Configuration Management\n- SSM parameters bridge the AMI Update Lambda and webhook handler\n- Webhook handler currently has hardcoded AMI - this removes that\n- Parameter format should be JSON for extensibility","status":"closed","priority":2,"issue_type":"task","owner":"cwacek@gmail.com","created_at":"2026-01-27T15:02:02.887393-05:00","created_by":"Chris Wacek","updated_at":"2026-01-27T15:33:22.670325-05:00","closed_at":"2026-01-27T15:33:22.670325-05:00","close_reason":"Completed: SSM path generation, AMI from SSM config used in provisioner, webhook rejects jobs with pending AMI","labels":["infrastructure"],"dependencies":[{"issue_id":"ar-9ip.5","depends_on_id":"ar-9ip","type":"parent-child","created_at":"2026-01-27T15:02:02.889007-05:00","created_by":"Chris Wacek"},{"issue_id":"ar-9ip.5","depends_on_id":"ar-9ip.1","type":"blocks","created_at":"2026-01-27T15:02:25.004914-05:00","created_by":"Chris Wacek"},{"issue_id":"ar-9ip.5","depends_on_id":"ar-9ip.4","type":"blocks","created_at":"2026-01-27T15:02:25.318238-05:00","created_by":"Chris Wacek"}]}
{"id":"ar-9ip.6","title":"Status Page Testing","description":"## Requirements\n- Unit tests for status aggregation logic (ready/building/degraded)\n- Unit tests for DynamoDB conditional write logic\n- Unit tests for human-readable message generation\n- Unit tests for preset configuration validation\n- Integration tests for end-to-end flows\n\n## Acceptance Criteria\n- Status aggregation tests cover all state combinations\n- Conditional write tests verify older timestamps don't overwrite newer\n- Message generation tests verify all status scenarios have clear messages\n- Preset validation tests cover valid configs and all error cases\n- Integration tests verify Lambda handlers work with mocked AWS services\n- Code coverage meets project standards\n\n## Context\n- Blocked by: AMI Update Lambda, Status API Lambda, Preset Configuration Management, SSM Parameter Integration\n- Use Jest for all tests (already configured in project)\n- Mock AWS SDK calls in unit tests\n- Consider using aws-sdk-client-mock for cleaner mocking","status":"closed","priority":2,"issue_type":"task","owner":"cwacek@gmail.com","created_at":"2026-01-27T15:02:03.236013-05:00","created_by":"Chris Wacek","updated_at":"2026-01-27T15:36:01.784785-05:00","closed_at":"2026-01-27T15:36:01.784785-05:00","close_reason":"Implemented unit tests for: status aggregation logic, message generation, preset validation, AMI update handler preset name extraction","labels":["testing"],"dependencies":[{"issue_id":"ar-9ip.6","depends_on_id":"ar-9ip","type":"parent-child","created_at":"2026-01-27T15:02:03.23698-05:00","created_by":"Chris Wacek"},{"issue_id":"ar-9ip.6","depends_on_id":"ar-9ip.2","type":"blocks","created_at":"2026-01-27T15:02:25.621637-05:00","created_by":"Chris Wacek"},{"issue_id":"ar-9ip.6","depends_on_id":"ar-9ip.3","type":"blocks","created_at":"2026-01-27T15:02:25.933859-05:00","created_by":"Chris Wacek"},{"issue_id":"ar-9ip.6","depends_on_id":"ar-9ip.4","type":"blocks","created_at":"2026-01-27T15:02:26.244895-05:00","created_by":"Chris Wacek"},{"issue_id":"ar-9ip.6","depends_on_id":"ar-9ip.5","type":"blocks","created_at":"2026-01-27T15:02:26.563531-05:00","created_by":"Chris Wacek"}]}
{"id":"ar-9ip.7","title":"Status Page Documentation","description":"## Requirements\n- Update README with preset configuration format and examples\n- Document /status endpoint response format and usage\n- Remove manual AMI ID steps from deployment documentation\n- Add troubleshooting guide for common issues\n\n## Acceptance Criteria\n- README includes complete preset configuration example\n- /status endpoint documented with sample response\n- Manual AMI ID configuration steps removed or marked deprecated\n- Troubleshooting section covers: failed builds, stale AMIs, permission issues\n- Documentation is clear and follows existing style\n\n## Context\n- Blocked by: CDK Infrastructure Updates\n- Current README likely has manual AMI configuration steps\n- Documentation should reflect the new automated AMI management workflow\n- Include architecture diagram if helpful","status":"closed","priority":2,"issue_type":"task","owner":"cwacek@gmail.com","created_at":"2026-01-27T15:02:03.581046-05:00","created_by":"Chris Wacek","updated_at":"2026-01-27T15:37:56.265887-05:00","closed_at":"2026-01-27T15:37:56.265887-05:00","close_reason":"Updated README with: preset configuration format, status endpoint documentation, removed manual AMI setup steps, updated architecture diagram","labels":["documentation"],"dependencies":[{"issue_id":"ar-9ip.7","depends_on_id":"ar-9ip","type":"parent-child","created_at":"2026-01-27T15:02:03.582589-05:00","created_by":"Chris Wacek"},{"issue_id":"ar-9ip.7","depends_on_id":"ar-9ip.1","type":"blocks","created_at":"2026-01-27T15:02:26.880364-05:00","created_by":"Chris Wacek"}]}
{"id":"ar-9uj","title":"verify nothing is set to retain when deploying","description":"While we're iterating, we want stack teardowns to succeed. This means we don't want anything to retain when we tear down. We'll also need to fix that later, so make an issue to make sure we do retain critical things (if there are any)","status":"open","priority":2,"issue_type":"chore","owner":"cwacek@gmail.com","created_at":"2026-01-27T19:57:02.764919-05:00","created_by":"Chris Wacek","updated_at":"2026-01-27T19:57:02.764919-05:00"}
{"id":"ar-b6t","title":"fail deploy if required context values aren't present","description":"## Problem\nCurrently we use some (insane?) defaults for things like the GitHub server on deploy. Don't do that. Just fail a deploy.\n\n## Requirements\n- Remove default fallback values for required context/config values\n- Deploy should fail with a clear error message if required values are missing\n- If defaults are needed for testing purposes, come up with another way to inject for tests (e.g., test-specific config, environment variables for test mode)\n\n## Acceptance Criteria\n- Deploy fails with descriptive error when required context values are missing\n- No silent fallback to potentially incorrect default values\n- Tests can still run with appropriate test configuration","status":"closed","priority":2,"issue_type":"bug","owner":"cwacek@gmail.com","created_at":"2026-01-27T20:26:30.807136-05:00","created_by":"Chris Wacek","updated_at":"2026-01-27T20:33:36.954645-05:00","closed_at":"2026-01-27T20:33:36.954645-05:00","close_reason":"Removed placeholder defaults and added validation in bin/app.ts that fails with clear error listing missing config values"}
{"id":"ar-psg","title":"Spot Runner: Project Foundation","description":"Implementation of the spot runner system for GitHub Actions on AWS spot instances. Zero-cost when idle, GHE Server integration, CDK deployment.","status":"closed","priority":2,"issue_type":"epic","owner":"cwacek@gmail.com","created_at":"2026-01-26T23:13:42.957029-05:00","created_by":"Chris Wacek","updated_at":"2026-01-27T12:13:34.10904-05:00","closed_at":"2026-01-27T12:13:34.10904-05:00","close_reason":"Project Foundation epic complete. All 12 tasks implemented:\n- Project setup with CDK, TypeScript, Jest\n- DynamoDB state management\n- GitHub App integration (JWT, JIT tokens, webhook validation)\n- Workflow routing with spotrunner/* label syntax\n- EC2 Fleet spot provisioning with on-demand fallback\n- Webhook handler Lambda with idempotent provisioning\n- Runner bootstrap with spot interruption handling\n- Cleanup Lambda for orphan/timeout detection\n- EC2 Image Builder pipeline for AMI creation\n- 65 tests covering unit and integration scenarios\n- Comprehensive documentation\n\nReady for deployment and testing."}
{"id":"ar-psg.1","title":"1. Project Setup","description":"Initialize CDK project with TypeScript\n\nTasks:\n- [ ] 1.1 Initialize CDK project with TypeScript\n- [ ] 1.2 Set up project structure (lib/, bin/, lambda/, ami/)\n- [ ] 1.3 Configure ESLint, Prettier, and TypeScript strict mode\n- [ ] 1.4 Add core dependencies (aws-cdk-lib, constructs, @aws-sdk/*)","status":"closed","priority":1,"issue_type":"task","owner":"cwacek@gmail.com","created_at":"2026-01-26T23:13:51.960694-05:00","created_by":"Chris Wacek","updated_at":"2026-01-26T23:19:51.285434-05:00","closed_at":"2026-01-26T23:19:51.285434-05:00","close_reason":"CDK project initialized with TypeScript, ESLint, Prettier, Jest","dependencies":[{"issue_id":"ar-psg.1","depends_on_id":"ar-psg","type":"parent-child","created_at":"2026-01-26T23:13:51.961643-05:00","created_by":"Chris Wacek"}]}
{"id":"ar-psg.10","title":"9. Infrastructure CDK Construct","description":"Main CDK construct assembly\n\nTasks:\n- [ ] 9.1 Create main SpotRunner construct with required props\n- [ ] 9.2 Implement VPC configuration (user-provided or create default)\n- [ ] 9.3 Create Secrets Manager resources for GitHub App credentials\n- [ ] 9.4 Create SSM parameters for default runner configurations\n- [ ] 9.5 Implement IAM roles with least-privilege policies\n- [ ] 9.6 Add stack outputs (webhook URL, secret ARN, table name)","status":"closed","priority":2,"issue_type":"task","owner":"cwacek@gmail.com","created_at":"2026-01-26T23:14:28.813895-05:00","created_by":"Chris Wacek","updated_at":"2026-01-27T09:13:10.080402-05:00","closed_at":"2026-01-27T09:13:10.080402-05:00","close_reason":"All tasks complete: main construct with props, VPC config (user-provided or default), Secrets Manager for credentials, SSM for default config, IAM roles with least-privilege, and stack outputs. All tests passing.","dependencies":[{"issue_id":"ar-psg.10","depends_on_id":"ar-psg","type":"parent-child","created_at":"2026-01-26T23:14:28.814706-05:00","created_by":"Chris Wacek"},{"issue_id":"ar-psg.10","depends_on_id":"ar-psg.2","type":"blocks","created_at":"2026-01-26T23:15:00.134684-05:00","created_by":"Chris Wacek"},{"issue_id":"ar-psg.10","depends_on_id":"ar-psg.6","type":"blocks","created_at":"2026-01-26T23:15:00.247378-05:00","created_by":"Chris Wacek"},{"issue_id":"ar-psg.10","depends_on_id":"ar-psg.7","type":"blocks","created_at":"2026-01-26T23:15:00.362489-05:00","created_by":"Chris Wacek"},{"issue_id":"ar-psg.10","depends_on_id":"ar-rds","type":"blocks","created_at":"2026-01-27T08:52:09.593044-05:00","created_by":"Chris Wacek"}]}
{"id":"ar-psg.11","title":"11. Testing","description":"Unit and integration tests\n\nTasks:\n- [ ] 11.1 Unit tests for label parsing and normalization\n- [ ] 11.2 Unit tests for GitHub App token generation\n- [ ] 11.3 Unit tests for webhook signature validation\n- [ ] 11.4 Integration tests for DynamoDB state operations\n- [ ] 11.5 Integration tests for end-to-end provisioning flow (mocked)","status":"closed","priority":3,"issue_type":"task","owner":"cwacek@gmail.com","created_at":"2026-01-26T23:14:29.247211-05:00","created_by":"Chris Wacek","updated_at":"2026-01-27T10:35:04.800927-05:00","closed_at":"2026-01-27T10:35:04.800927-05:00","close_reason":"Added comprehensive test coverage:\n- state.test.ts: 10 tests for DynamoDB state operations (createRunnerState, getRunnerState, updateRunnerState, deleteRunnerState, queryRunnersByStatus, queryStaleRunners)\n- webhook-handler.test.ts: 8 integration tests for end-to-end provisioning flow including signature validation, event filtering, idempotency, successful provisioning, spot fallback, and error handling\n- Total: 65 tests passing (was 42)","dependencies":[{"issue_id":"ar-psg.11","depends_on_id":"ar-psg","type":"parent-child","created_at":"2026-01-26T23:14:29.247975-05:00","created_by":"Chris Wacek"},{"issue_id":"ar-psg.11","depends_on_id":"ar-psg.3","type":"blocks","created_at":"2026-01-26T23:15:00.778379-05:00","created_by":"Chris Wacek"},{"issue_id":"ar-psg.11","depends_on_id":"ar-psg.4","type":"blocks","created_at":"2026-01-26T23:15:00.89039-05:00","created_by":"Chris Wacek"},{"issue_id":"ar-psg.11","depends_on_id":"ar-psg.7","type":"blocks","created_at":"2026-01-26T23:15:01.00186-05:00","created_by":"Chris Wacek"},{"issue_id":"ar-psg.11","depends_on_id":"ar-psg.8","type":"blocks","created_at":"2026-01-26T23:15:01.113777-05:00","created_by":"Chris Wacek"}]}
{"id":"ar-psg.12","title":"12. Documentation","description":"User-facing documentation\n\nTasks:\n- [ ] 12.1 Write README with quick start guide\n- [ ] 12.2 Document GitHub App setup process for GHE Server\n- [ ] 12.3 Document runner configuration options (SSM parameters)\n- [ ] 12.4 Document custom AMI creation\n- [ ] 12.5 Add architecture diagram","status":"closed","priority":3,"issue_type":"task","owner":"cwacek@gmail.com","created_at":"2026-01-26T23:14:29.678213-05:00","created_by":"Chris Wacek","updated_at":"2026-01-27T12:13:22.187526-05:00","closed_at":"2026-01-27T12:13:22.187526-05:00","close_reason":"Created comprehensive README.md covering:\n- Quick start guide with step-by-step deployment\n- GitHub App setup process for GHE Server\n- Runner configuration options (SSM parameters, label syntax, spot strategies)\n- Custom AMI creation (EC2 Image Builder and manual options)\n- Architecture diagram and component descriptions\n- Security considerations\n- Troubleshooting guide","dependencies":[{"issue_id":"ar-psg.12","depends_on_id":"ar-psg","type":"parent-child","created_at":"2026-01-26T23:14:29.678985-05:00","created_by":"Chris Wacek"},{"issue_id":"ar-psg.12","depends_on_id":"ar-psg.10","type":"blocks","created_at":"2026-01-26T23:15:01.536865-05:00","created_by":"Chris Wacek"},{"issue_id":"ar-psg.12","depends_on_id":"ar-psg.5","type":"blocks","created_at":"2026-01-26T23:15:01.651921-05:00","created_by":"Chris Wacek"}]}
{"id":"ar-psg.2","title":"2. DynamoDB State Management","description":"Runner state tracking with DynamoDB\n\nTasks:\n- [ ] 2.1 Define DynamoDB table schema (job ID as partition key)\n- [ ] 2.2 Create CDK construct for runners state table\n- [ ] 2.3 Implement state operations: create, update, delete, query by status\n- [ ] 2.4 Add TTL for automatic cleanup of old records","status":"closed","priority":2,"issue_type":"task","owner":"cwacek@gmail.com","created_at":"2026-01-26T23:14:02.303365-05:00","created_by":"Chris Wacek","updated_at":"2026-01-26T23:21:39.81316-05:00","closed_at":"2026-01-26T23:21:39.81316-05:00","close_reason":"DynamoDB table with jobId PK, status GSI, TTL, and state operations implemented","dependencies":[{"issue_id":"ar-psg.2","depends_on_id":"ar-psg","type":"parent-child","created_at":"2026-01-26T23:14:02.304084-05:00","created_by":"Chris Wacek"},{"issue_id":"ar-psg.2","depends_on_id":"ar-psg.1","type":"blocks","created_at":"2026-01-26T23:14:51.204428-05:00","created_by":"Chris Wacek"}]}
{"id":"ar-psg.3","title":"3. GitHub App Integration","description":"GitHub Enterprise Server App integration\n\nTasks:\n- [ ] 3.1 Implement GitHub App JWT generation from private key\n- [ ] 3.2 Implement installation access token exchange with caching\n- [ ] 3.3 Implement JIT runner registration token request\n- [ ] 3.4 Create webhook signature validation utility\n- [ ] 3.5 Add support for multiple GitHub Enterprise Server installations","status":"closed","priority":2,"issue_type":"task","owner":"cwacek@gmail.com","created_at":"2026-01-26T23:14:02.718886-05:00","created_by":"Chris Wacek","updated_at":"2026-01-26T23:23:15.181853-05:00","closed_at":"2026-01-26T23:23:15.181853-05:00","close_reason":"GitHub App JWT, installation tokens, JIT runner tokens, and webhook validation implemented with tests","dependencies":[{"issue_id":"ar-psg.3","depends_on_id":"ar-psg","type":"parent-child","created_at":"2026-01-26T23:14:02.719577-05:00","created_by":"Chris Wacek"},{"issue_id":"ar-psg.3","depends_on_id":"ar-psg.1","type":"blocks","created_at":"2026-01-26T23:14:51.319718-05:00","created_by":"Chris Wacek"}]}
{"id":"ar-psg.4","title":"4. Workflow Routing","description":"Label-based job routing to runner configurations\n\nTasks:\n- [ ] 4.1 Implement spotrunner/\u003cconfig\u003e/\u003copts\u003e label parser\n- [ ] 4.2 Implement label normalization (case, ordering)\n- [ ] 4.3 Create SSM parameter lookup for runner configurations\n- [ ] 4.4 Implement configuration validation (required fields, types)\n- [ ] 4.5 Add resource requirement parsing (cpu=N, ram=N options)","status":"closed","priority":2,"issue_type":"task","owner":"cwacek@gmail.com","created_at":"2026-01-26T23:14:03.180887-05:00","created_by":"Chris Wacek","updated_at":"2026-01-26T23:24:19.301748-05:00","closed_at":"2026-01-26T23:24:19.301748-05:00","close_reason":"Label parser (spotrunner/\u003cconfig\u003e/\u003copts\u003e), normalization, SSM lookup, config validation, and resource parsing implemented with tests","dependencies":[{"issue_id":"ar-psg.4","depends_on_id":"ar-psg","type":"parent-child","created_at":"2026-01-26T23:14:03.181601-05:00","created_by":"Chris Wacek"},{"issue_id":"ar-psg.4","depends_on_id":"ar-psg.1","type":"blocks","created_at":"2026-01-26T23:14:51.433866-05:00","created_by":"Chris Wacek"}]}
{"id":"ar-psg.5","title":"10. AMI Pipeline","description":"Pre-baked runner AMI creation using EC2 Image Builder\n\nTasks:\n- [x] 10.1 Create EC2 Image Builder CDK construct (RunnerImagePipeline)\n- [x] 10.2 Image Builder component: Install Docker\n- [x] 10.3 Image Builder component: Install GitHub Actions runner with SHA256 verification\n- [x] 10.4 Image Builder component: Pre-pull common Docker images (node, python, golang, etc.)\n- [ ] 10.5 Add support for custom Image Builder components\n- [ ] 10.6 Document custom AMI creation options (use pipeline or provide own AMI)\n\nDecision: Using EC2 Image Builder instead of Packer because:\n- No external tooling required (users don't need Packer installed)\n- CDK-native (image pipeline defined alongside infrastructure)\n- Automatic scheduling, versioning, cross-account distribution\n- Consistent with project goal of 'one CDK stack with minimal configuration'","status":"closed","priority":3,"issue_type":"task","owner":"cwacek@gmail.com","created_at":"2026-01-26T23:14:03.592276-05:00","created_by":"Chris Wacek","updated_at":"2026-01-27T09:32:56.190555-05:00","closed_at":"2026-01-27T09:32:56.190555-05:00","close_reason":"Implemented EC2 Image Builder pipeline (RunnerImagePipeline CDK construct) instead of Packer. The construct creates AMIs with Docker, GitHub Actions runner (SHA256 verified), and pre-pulled Docker images. Users can customize with additionalDockerImages and additionalComponentArns props. Decision documented in design.md - Image Builder chosen for CDK-native integration and no external tooling requirement.","dependencies":[{"issue_id":"ar-psg.5","depends_on_id":"ar-psg","type":"parent-child","created_at":"2026-01-26T23:14:03.593031-05:00","created_by":"Chris Wacek"},{"issue_id":"ar-psg.5","depends_on_id":"ar-psg.1","type":"blocks","created_at":"2026-01-26T23:14:51.545971-05:00","created_by":"Chris Wacek"}]}
{"id":"ar-psg.6","title":"5. Spot Provisioning","description":"EC2 spot instance provisioning\n\nTasks:\n- [ ] 5.1 Create EC2 launch template construct with spot configuration\n- [ ] 5.2 Implement capacity-optimized spot request with multiple instance types\n- [ ] 5.3 Implement on-demand fallback logic (after N failures)\n- [ ] 5.4 Add multi-AZ provisioning support\n- [ ] 5.5 Implement instance tagging (job-id, repo, workflow, labels)\n- [ ] 5.6 Create user data script template with JIT token injection","status":"closed","priority":2,"issue_type":"task","owner":"cwacek@gmail.com","created_at":"2026-01-26T23:14:18.195925-05:00","created_by":"Chris Wacek","updated_at":"2026-01-26T23:26:28.657253-05:00","closed_at":"2026-01-26T23:26:28.657253-05:00","close_reason":"EC2 Fleet spot provisioning with capacity-optimized strategy, on-demand fallback, multi-AZ, tagging, and user data generation","dependencies":[{"issue_id":"ar-psg.6","depends_on_id":"ar-psg","type":"parent-child","created_at":"2026-01-26T23:14:18.196634-05:00","created_by":"Chris Wacek"},{"issue_id":"ar-psg.6","depends_on_id":"ar-psg.2","type":"blocks","created_at":"2026-01-26T23:14:51.957815-05:00","created_by":"Chris Wacek"},{"issue_id":"ar-psg.6","depends_on_id":"ar-psg.4","type":"blocks","created_at":"2026-01-26T23:14:52.075959-05:00","created_by":"Chris Wacek"}]}
{"id":"ar-psg.7","title":"6. Runner Lifecycle Lambda","description":"Main webhook handler Lambda\n\nTasks:\n- [ ] 6.1 Create Lambda function scaffold with API Gateway integration\n- [ ] 6.2 Implement workflow_job.queued webhook handler\n- [ ] 6.3 Implement idempotent provisioning (job ID dedup via DynamoDB)\n- [ ] 6.4 Wire up GitHub App auth → JIT token → EC2 provisioning flow\n- [ ] 6.5 Return appropriate HTTP responses (200, 401, 500)","status":"closed","priority":2,"issue_type":"task","owner":"cwacek@gmail.com","created_at":"2026-01-26T23:14:18.613947-05:00","created_by":"Chris Wacek","updated_at":"2026-01-26T23:28:22.788504-05:00","closed_at":"2026-01-26T23:28:22.788504-05:00","close_reason":"Lambda webhook handler with API Gateway, idempotent provisioning, GitHub App → JIT token → EC2 flow","dependencies":[{"issue_id":"ar-psg.7","depends_on_id":"ar-psg","type":"parent-child","created_at":"2026-01-26T23:14:18.614671-05:00","created_by":"Chris Wacek"},{"issue_id":"ar-psg.7","depends_on_id":"ar-psg.2","type":"blocks","created_at":"2026-01-26T23:14:52.506924-05:00","created_by":"Chris Wacek"},{"issue_id":"ar-psg.7","depends_on_id":"ar-psg.3","type":"blocks","created_at":"2026-01-26T23:14:52.62033-05:00","created_by":"Chris Wacek"},{"issue_id":"ar-psg.7","depends_on_id":"ar-psg.4","type":"blocks","created_at":"2026-01-26T23:14:52.733774-05:00","created_by":"Chris Wacek"},{"issue_id":"ar-psg.7","depends_on_id":"ar-psg.6","type":"blocks","created_at":"2026-01-26T23:14:52.847057-05:00","created_by":"Chris Wacek"}]}
{"id":"ar-psg.8","title":"7. Runner Instance Bootstrap","description":"EC2 instance bootstrap and self-management\n\nTasks:\n- [ ] 7.1 Create bootstrap script: retrieve JIT token from user data\n- [ ] 7.2 Implement runner registration with GitHub Enterprise Server\n- [ ] 7.3 Implement job completion detection and self-termination\n- [ ] 7.4 Add DynamoDB status update on registration success/failure\n- [ ] 7.5 Implement spot interruption handler (metadata polling)","status":"closed","priority":2,"issue_type":"task","owner":"cwacek@gmail.com","created_at":"2026-01-26T23:14:19.049664-05:00","created_by":"Chris Wacek","updated_at":"2026-01-26T23:29:44.333423-05:00","closed_at":"2026-01-26T23:29:44.333423-05:00","close_reason":"Bootstrap script with IMDSv2, JIT config, spot interruption handler, timeout watchdog, and self-termination","dependencies":[{"issue_id":"ar-psg.8","depends_on_id":"ar-psg","type":"parent-child","created_at":"2026-01-26T23:14:19.0504-05:00","created_by":"Chris Wacek"},{"issue_id":"ar-psg.8","depends_on_id":"ar-psg.3","type":"blocks","created_at":"2026-01-26T23:14:53.263256-05:00","created_by":"Chris Wacek"},{"issue_id":"ar-psg.8","depends_on_id":"ar-psg.6","type":"blocks","created_at":"2026-01-26T23:14:53.378156-05:00","created_by":"Chris Wacek"}]}
{"id":"ar-psg.9","title":"8. Cleanup \u0026 Timeout Handling","description":"Orphan detection and timeout enforcement\n\nTasks:\n- [ ] 8.1 Create scheduled Lambda for orphan instance detection\n- [ ] 8.2 Implement provisioning timeout check (default: 10 min)\n- [ ] 8.3 Implement job timeout check (default: 1 hr)\n- [ ] 8.4 Add instance termination with DynamoDB cleanup\n- [ ] 8.5 Implement CloudWatch alarms for stuck instances","status":"closed","priority":2,"issue_type":"task","owner":"cwacek@gmail.com","created_at":"2026-01-26T23:14:19.462515-05:00","created_by":"Chris Wacek","updated_at":"2026-01-26T23:31:14.165684-05:00","closed_at":"2026-01-26T23:31:14.165684-05:00","close_reason":"Cleanup Lambda with scheduled trigger, provisioning/job timeout checks, orphan detection, and CloudWatch alarm","dependencies":[{"issue_id":"ar-psg.9","depends_on_id":"ar-psg","type":"parent-child","created_at":"2026-01-26T23:14:19.463299-05:00","created_by":"Chris Wacek"},{"issue_id":"ar-psg.9","depends_on_id":"ar-psg.2","type":"blocks","created_at":"2026-01-26T23:14:59.594427-05:00","created_by":"Chris Wacek"},{"issue_id":"ar-psg.9","depends_on_id":"ar-psg.7","type":"blocks","created_at":"2026-01-26T23:14:59.708365-05:00","created_by":"Chris Wacek"}]}
{"id":"ar-rcf","title":"cdk commands are hanging","status":"tombstone","priority":2,"issue_type":"bug","owner":"cwacek@gmail.com","created_at":"2026-01-27T08:51:26.083228-05:00","created_by":"Chris Wacek","updated_at":"2026-01-27T08:51:50.149771-05:00","deleted_at":"2026-01-27T08:51:50.149771-05:00","deleted_by":"daemon","delete_reason":"delete","original_type":"bug"}
{"id":"ar-rds","title":"cdk commands are hanging","description":"Tests are hanging because any kind of instantiation of the spot-runner-stack.ts is hanging. Basic `npx cdk synth` commands also hang. To verify, try running spot-runner-stack.test.ts (but with a timeout of no more than 10 seconds)","status":"closed","priority":2,"issue_type":"bug","owner":"cwacek@gmail.com","created_at":"2026-01-27T08:51:42.539206-05:00","created_by":"Chris Wacek","updated_at":"2026-01-27T09:12:49.415332-05:00","closed_at":"2026-01-27T09:12:49.415332-05:00","close_reason":"Fixed by installing esbuild as dev dependency. CDK's NodejsFunction was falling back to Docker bundling (for ARM64 cross-compilation) because esbuild wasn't available locally. With esbuild installed, CDK uses local bundling which completes in milliseconds instead of hanging on Docker buildx."}
{"id":"ar-yc8","title":"Ensure shasum checks on all network fetches","status":"tombstone","priority":2,"issue_type":"task","owner":"cwacek@gmail.com","created_at":"2026-01-26T23:29:08.696088-05:00","created_by":"Chris Wacek","updated_at":"2026-01-26T23:29:51.553384-05:00","deleted_at":"2026-01-26T23:29:51.553384-05:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
